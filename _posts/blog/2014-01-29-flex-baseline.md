---

categories: blog

layout: post

published: true

invisible: true

---

# Гибкая базовая линия

Когда-то наилучшим решением для инлайновых блоков были, ну, инлайн-блоки. Я очень люблю их за то, что они очень хорошо решают множество задач.

Но они не всемогущи. Они не умеют правильно работать с вертикальным выравниванием текста. Причём проблема описана в [соответствующей спецификации][bug1], достаточно прочитать самый последний абзац:

> The baseline of an 'inline-block' is the baseline of its last line box in the normal flow, unless it has either no in-flow line boxes or if its 'overflow' property has a computed value other than 'visible', in which case the baseline is the bottom margin edge.

Тут аж две проблемы:

1. Для многострочных инлайн-блоков *базовой линией* является базовая линия **последнего** строчного бокса в обычном потоке.

2. Если внутри инлайн-блока нет боксов обычного потока или же у инлайн-блока стоит `overflow` отличный от `visible`, то *базовой линией* становится нижняя граница блока.

Из-за этих проблем по базовой линии получится выровнить только однострочные блоки без заданного `overflow`, тогда как в любых более сложных случаях мы будем получать далеко не то, что нам будет нужно.

Вот пример, первый блок все три блока — инлайн-блоки. Первый — обычный однострочный, второй — многострочный, третий — однострочный, но с `overflow: auto`:

[demo:flex-baseline1]

Тут хорошо видно, где у какого блока находится базовая линия.

## inline-table

На самом деле в CSS было одно место, где вертикальное выравнивание работало *правильно* — `inline-table`. Заменяем инлайн-блоки на него и получаем, казалось бы, то, что нужно:

[demo:flex-baseline2]

Но тут сразу видно: не работает overflow: auto. Ну и нужно не забывать задавать такому блоку `table-layout: fixed`. Но в целом, практически идеально, если не нужен `overflow: auto`.

## Спасительный flex

Можно ли сделать блок и правильно выравнивающийся, и со скроллбаром? Тут на помощь спешат флексбоксы, точнее, `display: inline-flex`. В теории он также имеет правильное положение базовой линии — как у таблиц, но что мы получаем на практике?

[demo:flex-baseline3]

Если вы смотрите на этот пример в любом браузере кроме Fx (да, даже в IE10 и 12-й  Опере), то вы видите идельно выровненные блоки.

Но в Firefox блок с `overflow: auto`, внезапно, работает аналогично инлайн-блоку — теряет базовую линию. Грусть, печаль, разочарование, придётся ждать исправления [свежезарепорченного бага](https://bugzilla.mozilla.org/show_bug.cgi?id=969874).

## А если иначе?

Очень здорово, что `inline-flex` сам по себе выравнивается правильно относительно остальных блоков, если бы не баг Fx, всё было бы совсем замечательно. Но что если мы попробуем выравнивать не разные `inline-flex` относительно друг друга, а элементы внутри флексбокса относительно друг друга?

[demo:flex-baseline4]

Оп! Всё работает! Вот только… Если отдельные блоки с `inline-flex` сами по себе врапаются на новую строку, то для элементов внутри флексбокса нам надо было бы применять `flex-wrap`. А, как известно, Firefox его пока не поддерживает!

## All together

Так! Но ведь если `inline-flex` прокидывает свою базовую линию наверх, а внутренний блок с `overflow: auto` также имеет правильное выравнивание даже в Firefox, то можно же совместить! Добавим в каждый блок по дополнительному элементу, да будем задавать паддинги и overflow уже на них:

[demo:flex-baseline5]

В нормальных браузерах ничего не поменялось, теперь посмотрим на Firefox… Так, блок уже выравнивается не по нижней границе, но и не по базовой линии. Хотя, давайте померяем разницу — 10 пикселей. Это же наш паддинг! Убираем паддинги по очереди — всё выравнивается ровно когда верхний паддинг становится равен нулю. Ага, значит ФФ в этом случае всё делает почти верно, но вот только всплыл новый баг. Как бы его обойти? Избавимся-ка от паддинга, заменив его на псевдо-элемент:

[demo:flex-baseline6]

Идеально! [Пойдём и зарепортим и этот баг][bug2].

## Последние штрихи

Ну ладно, не идеально. Остаётся одна мелочь, которая может проявиться в IE 10 — при заданной ширине флексбокса текст внутри него не будет врапаться даже если не будет стоять `white-space: nowrap`. Довольно странный баг, обходится либо заданием внутреннему блоку явную ширину в 100%, либо, что чуть более правильно, добавлением этому внутреннему элементу  `-ms-flex-negative: 1`.

Вот теперь идеально, вот последний пример с разными вариантами, которые врапаются со строчки на строчку:

[demo:flex-baseline7]

Код для всего этого дела получается вот таким:

{:.language-css}
    .flex {
        display: -ms-inline-flexbox;
        display: -webkit-inline-flex;
        display: inline-flex;

        vertical-align: baseline;
        }

    .flex-content {
        padding: 0 10px 10px;
        border: 1px solid lime;

        /* Fixing IE issue */
        -ms-flex-negative: 1;
        }

    /* Fixing Fx issue */
    .flex-content:before {
        content: "";
        display: block;
        padding-top: 10px;
        }

## Итого

Ох уж этот Firefox! Если бы не он, то мы могли бы обойтись одним элементом для каждого инлайнового блока, который мы хотим выровнить по базовой линии, но из-за его багов приходится довольствоваться двумя. Либо, если вам не нужен overflow отличный от visible и вы не боитесь таблиц, то вы можете попробовать использовать `display: inline-table`.

Но в итоге мы победили и теперь можем выравнивать блоки по их базовым линиям вне зависимости от их сложности, ура! Но если вы хотите применять эту технику без лишних блоков, стоит пойти и проголосовать за исправление [соответствующих][bug1] [багов][bug2] в багзилле.

[bug1]: https://bugzilla.mozilla.org/show_bug.cgi?id=969874
[bug2]: https://bugzilla.mozilla.org/show_bug.cgi?id=969880