---

categories: blog

layout: post

published: true

invisible: true

---

# Гибкая базовая линия

Когда-то наилучшим решением для инлайновых блоков были, ну, инлайн-блоки. Я очень люблю их за то, что они очень хорошо решают множество задач.

Но они не всемогущи. Они не умеют правильно работать с вертикальным выравниванием текста. Причём проблема описана в [соответствующей спецификации](http://www.w3.org/TR/CSS2/visudet.html#propdef-vertical-align), достаточно прочитать самый последний абзац:

> The baseline of an 'inline-block' is the baseline of its last line box in the normal flow, unless it has either no in-flow line boxes or if its 'overflow' property has a computed value other than 'visible', in which case the baseline is the bottom margin edge.

Тут аж две проблемы:

1. Для многострочных инлайн-блоков *базовой линией* является базовая линия **последнего** строчного бокса в обычном потоке.

2. Если внутри инлайн-блока нет боксов обычного потока или же у инлайн-блока стоит `overflow` отличный от `visible`, то *базовой линией* становится нижняя граница блока.

Из-за этих проблем по базовой линии получится выровнить только однострочные блоки без заданного `overflow`, тогда как в любых более сложных случаях мы будем получать далеко не то, что нам будет нужно.

Вот пример, первый блок все три блока — инлайн-блоки. Первый — обычный однострочный, второй — многострочный, третий — однострочный, но с `overflow: auto`:

[demo:flex-baseline1]

Тут хорошо видно, где у какого блока находится базовая линия.

## inline-table

На самом деле в CSS было одно место, где вертикальное выравнивание работало *правильно* — `inline-table`. Заменяем инлайн-блоки на него и получаем, казалось бы, то, что нужно:

[demo:flex-baseline2]

Но тут сразу видно: не работает overflow: auto. Ну и нужно не забывать задавать такому блоку `table-layout: fixed`. Но в целом, практически идеально, если не нужен `overflow: auto`.

## Спасительный flex

Можно ли сделать блок и правильно выравнивающийся, и со скроллбаром? Тут на помощь спешат флексбоксы, точнее, `display: inline-flex`. В теории он также имеет правильное положение базовой линии — как у таблиц, но что мы получаем на практике?

[demo:flex-baseline3]

Если вы смотрите на этот пример в любом браузере кроме Fx (да, даже в IE10 и 12-й  Опере), то вы видите идельно выровненные блоки.

Но в Firefox блок с `overflow: auto`, внезапно, работает аналогично инлайн-блоку — теряет базовую линию.

### Многострочные дети

Чтобы выровнять детей по честной базовой линии **первой строчки**, достаточно врапперу сказать

{:.language-css}
    display: flex;
    align-items: baseline;

*пример*

Во всех современных браузерах *проверить в ие* это заработает! Ура!

### overflow

А вот с `overflow`, отличным от `visible` всё чуть сложнее.

{:.language-css}
    display: flex;
    align-items: baseline;
    overflow: hidden;

*пример*

Если в вебкитах базовая линия останется верной, то для ФФ всё будет хорошо пока верхний паддинг для внутреннего элемента равен нулю. Но как только мы сделаем его положительным, всё поедет — ровно на размер этого паддинга.

*есть ли воркэраунд?*

## inline-flex

Ок, флексбокс может помочь нам расположить всё правильно внутри элемента с `display: flex`.

Но как будет позиционироваться инлайн-флексовый блок относительно других блоков в том же инлайновом контексте? Можно было ожидать фейла, но, оказывается, всё немного радужнее.

### Многострочный inline-flex

Со многострочностью, опять, всё хорошо: такой блок, в отличие от инлайн-блока, будет иметь базовую линию на первой строчке.

*пример*

### inline-flex с overflow

А вот с overflow всё печальнее: в вебкитах всё ок, но всё опять взрывается в Fx, причём на этот раз совсем: Fx в этом случае ведёт себя как с инлайн-блоками и ставит базовую линию на нижнюю границу маджина.

*пример*

## Итого

В заключение можно сказать, что для выравнивания по базовой линии флексбокс оказывается незаменим. Для надёжного выравнивания лучше использовать выравнивание через `align-items` + воркэраунд для верхнего паддинга внутри блоков с overflow, отличным от ноля.

Выравнивать инлайн-флексы относительно друг друга можно, но только с overflow: visible, пока не будет починен соответствующий баг в ФФ.

*найти/завести баги ФФ*