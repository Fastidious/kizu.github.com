---

categories: blog

layout: post

published: true

invisible: true

---

# Гибкая базовая линия

Когда-то наилучшим решением для инлайновых блоков были, ну, инлайн-блоки. Я очень люблю их за то, что они очень хорошо решают множество задач.

Но они не всемогущи. Они не умеют правильно работать с вертикальным выравниванием текста. Причём проблема описана в [соответствующей спецификации](http://www.w3.org/TR/CSS2/visudet.html#propdef-vertical-align), достаточно прочитать самый последний абзац:

> The baseline of an 'inline-block' is the baseline of its last line box in the normal flow, unless it has either no in-flow line boxes or if its 'overflow' property has a computed value other than 'visible', in which case the baseline is the bottom margin edge.

Тут аж две проблемы:

1. Для многострочных инлайн-блоков *базовой линией* является базовая линия **последнего** строчного бокса в обычном потоке.

2. Если внутри инлайн-блока нет боксов обычного потока или же у инлайн-блока стоит `overflow` отличный от `visible`, то *базовой линией* становится нижняя граница блока.

Из-за этих проблем по базовой линии получится выровнить только однострочные блоки без заданного `overflow`, тогда как в любых более сложных случаях мы будем получать далеко не то, что нам будет нужно.

Вот пример, первый блок все три блока — инлайн-блоки. Первый — обычный однострочный, второй — многострочный, третий — однострочный, но с `overflow: auto`:

[demo:flex-baseline1]

Тут хорошо видно, где у какого блока находится базовая линия.

## inline-table

На самом деле в CSS было одно место, где вертикальное выравнивание работало *правильно* — `inline-table`. Заменяем инлайн-блоки на него и получаем, казалось бы, то, что нужно:

[demo:flex-baseline2]

Но тут сразу видно: не работает overflow: auto. Ну и нужно не забывать задавать такому блоку `table-layout: fixed`. Но в целом, практически идеально, если не нужен `overflow: auto`.

## Спасительный flex

Можно ли сделать блок и правильно выравнивающийся, и со скроллбаром? Тут на помощь спешат флексбоксы, точнее, `display: inline-flex`. В теории он также имеет правильное положение базовой линии — как у таблиц, но что мы получаем на практике?

[demo:flex-baseline3]

Если вы смотрите на этот пример в любом браузере кроме Fx (да, даже в IE10 и 12-й  Опере), то вы видите идельно выровненные блоки.

Но в Firefox блок с `overflow: auto`, внезапно, работает аналогично инлайн-блоку — теряет базовую линию. Грусть, печаль, разочарование, придётся ждать исправления зарепорченного бага.

## А если иначе?

Очень здорово, что `inline-flex` сам по себе выравнивается правильно относительно остальных блоков, если бы не баг Fx, всё было бы совсем замечательно. Но что если мы попробуем выравнивать не разные `inline-flex` относительно друг друга, а элементы внутри флексбокса относительно друг друга?

[demo:flex-baseline4]

Оп! Всё работает! Вот только… Если отдельные блоки с `inline-flex` сами по себе врапаются на новую строку, то для элементов внутри флексбокса нам надо было бы применять `flex-wrap`. А, как известно, Firefox его пока не поддерживает!

## All together

Так! Но ведь если `inline-flex` прокидывает свою базовую линию наверх, а внутренний блок с `overflow: auto` также имеет правильное выравнивание даже в Firefox, то можно же совместить! Добавим в каждый блок по дополнительному элементу, да будем задавать паддинги и overflow уже на них:

[demo:flex-baseline5]


## Итого

…