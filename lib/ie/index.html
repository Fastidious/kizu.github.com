<!DOCTYPE html>
<html lang="ru" class="Page Page_page Page_ru without-sidebar">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Систематизация экспрешнов</title>
    <link rel="alternate" type="application/atom+xml" title="Atom feed" href="http://feeds.feedburner.com/kizu">
    <link rel="stylesheet" href="/s/style.css">
    <link rel="preload" href="/s/extras2.css" as="style" onload="this.rel='stylesheet'">
  </head>
  <body class="Page-Body">
    <header class="Page-Header">
      <div class="LiquidLayout">
        <div class="LiquidLayout-Content">
          <h1 class="Page-Title"><a href="/" class="Page-Title-Link">Роман Комаров</a>
          </h1>
          <ul class="Page-Languages">
            <li class="Page-Language"><a data-short="en" title="No translation for this article (yet?), but a lot of other english pages are available!" href="/en/" class="Page-Language-Link">in English*</a>
            </li>
            <li data-short="ru" class="Page-Language is-current">по-русски
            </li>
          </ul>
        </div>
      </div>
    </header>
    <div role="main" class="Page-Content Main">
      <header><h1 class="Heading" id="систематизация-экспрешнов"><a class="Anchor" aria-hidden="true" href="#систематизация-экспрешнов"></a><span class="ss02 hang-xs">С</span>истематизация экспрешнов</h1>
      </header>
<ul>
<li><a class="Link" href="#Png">Ис­прав­ле­ние по­лу­про­зрач­ных png</a> <sup><a class="Link" href="png.html">при­мер</a></sup></li>
<li><a class="Link" href="#MinMax">Ми­ни­маль­ные/​​мак­си­маль­ные ши­ри­ны/​​вы­со­ты</a> <sup><a class="Link" href="minmax.html">при­мер</a></sup></li>
<li><a class="Link" href="#Positioning">По­зи­ци­о­ни­ро­ва­ние</a></li>
<li><a class="Link" href="#Select">Пе­ре­кры­тие се­лек­тов ай­фрей­мом</a> <sup><a class="Link" href="select.html">при­мер</a></sup> </li>
<li><a class="Link" href="#Height">Рас­тя­ги­ва­ние вы­со­ты</a></li>
<li><a class="Link" href="#Opacity">Opac­ity</a></li>
<li><a class="Link" href="#Dpi">Раз­мер шриф­та в за­ви­си­мо­сти от dpi</a></li>
<li><a class="Link" href="#Counter">Ре­а­ли­за­ция про­сто­го счёт­чи­ка</a> <sup><a class="Link" href="counter.html">при­мер</a></sup> </li>
<li><a class="Link" href="#Pseudoclass">Эму­ля­ция псев­до­клас­сов (<code>:hover</code>, <code>:fo­cus</code>, <code>:tar­get</code>)</a> <sup><a class="Link" href="pseudoclass.html">при­мер</a></sup></li>
<li><a class="Link" href="#Credits">Бла­го­дар­но­сти</a></li>
</ul>
<p>Неболь­шой dis­claimer: ис­поль­зуй­те на­пиль­ник, по­жа­луй­ста,<span class="nobr"> —</span><span class="thinsp"> </span>прак­ти­че­ски все­гда в экс­преш­нах надо что-либо до­пилить!</p>
<h2 class="Heading" id="Png"><a class="Anchor" aria-hidden="true" href="#Png"></a><span class="ss01 hang-m">И</span>справление полупрозрачных png</h2>
<p>Тупо фильтр</p>
<pre><code class="undefinedCSS">* HTML .png-crop {
    background-image:none;
    zoom:1;
    filter:progid:DXImageTransform.Microsoft.AlphaImageLoader(src=&quot;ololo.png&quot;, sizingMethod=&quot;crop&quot;);
    }
</code></pre>
<p>Ис­прав­ле­ние png с ме­то­дом crop (лёг­ким дви­же­ни­ем руки ме­ня­ет­ся на «scale»)</p>
<pre><code class="undefinedCSS">* HTML .png-crop {
    filter:expression(
        function(t){
            t.runtimeStyle.zoom = 1;
            t.runtimeStyle.filter = &#39;progid:DXImageTransform.Microsoft.AlphaImageLoader(src=&#39;+t.currentStyle.backgroundImage.split(&#39;\&quot;&#39;)[1]+&#39;, sizingMethod=crop)&#39;;
            t.runtimeStyle.backgroundImage = &#39;none&#39;;
        }(this)
    );
    }
</code></pre>
<p>Ис­прав­ле­ние png для <code>&lt;img /&gt;</code>, не ну­жен про­зрач­ный гиф. <sup><a class="Link" href="png.html">при­мер</a></sup>.</p>
<pre><code class="undefinedCSS">* HTML IMG {
    _visibility:expression(
        function(t){
            t.runtimeStyle.visibility = &#39;hidden&#39;;
            var png = document.createElement(&#39;png&#39;);
            png.style.cssText = &#39;zoom:1;filter:progid:DXImageTransform.Microsoft.AlphaImageLoader(src=&#39; + t.src + &#39;,sizingMethod=scale);&#39;;
            png.appendChild(t.replaceNode(png));
            if (png.parentNode.getAttribute(&#39;href&#39;)) {
                var pngclick = document.createElement(&#39;pngclick&#39;);
                pngclick.style.cssText = &#39;position:absolute;overflow:hidden;width:expression(runtimeStyle.width = parentNode.offsetWidth);height:expression(runtimeStyle.height = parentNode.offsetHeight);&#39;;
                t.parentNode.insertBefore(pngclick,t);
            }
        }(this)
    );
    }
</code></pre>
<h2 class="Heading" id="MinMax"><a class="Anchor" aria-hidden="true" href="#MinMax"></a><span class="ss01 hang-m">М</span>инимальные/максимальные ширины/высоты</h2>
<p>Толь­ко max-width, бе­рёт­ся из эле­мен­та, толь­ко пик­се­ли (воз­мож­но, сто­ит до­ба­вить про­вер­ку на из­ме­не­ние ши­ри­ны са­мо­го эле­мен­та). <sup><a class="Link" href="minmax.html">при­мер</a></sup>.</p>
<pre><code class="undefinedCSS">.maxwidth {
    zoom:1;
    maxwidth:expression(
        function(t){
            var w = t.parentNode.scrollWidth;
            if (w != t.w) {
                t.w = w;
                var max = parseInt(t.currentStyle[&#39;max-width&#39;], 10);
                t.style.width = &#39;auto&#39;;
                if (t.scrollWidth &gt; max) {
                    t.style.width = max;
                }
            }
        }(this)
    );
    }
</code></pre>
<p>min-width для <abbr>BODY</abbr>, бе­рёт­ся из свой­ства, толь­ко пик­се­ли (stan­dards-mode only (пока)) (+надо до­ба­вить ке­ши­ру­е­мость зна­че­ния<span class="nobr"> —</span><span class="thinsp"> </span>что­бы пе­ре­за­пи­сы­вать его толь­ко если ме­ня­ет­ся).</p>
<pre><code class="undefinedCSS">* HTML BODY
{
    zoom:expression(
        function(t){
            t.runtimeStyle.zoom = 1;
            var max = parseInt(t.currentStyle[&#39;min-width&#39;], 10);
            var f = function() {
                var w = document.documentElement.clientWidth;
                if (w != t.w) {
                    t.w = w;
                    if (w &lt; max) {
                        t.style.width = max;
                    } else {
                        t.style.width = &#39;auto&#39;;
                    }
                }
            };
            f();
            window.attachEvent(&#39;onresize&#39;,f);
        }(this)
    );
}
</code></pre>
<p>Max-width/​​max-height, толь­ко пик­се­ли, од­но­ра­зовый.</p>
<pre><code class="undefinedCSS">IMG {
    zoom:expression(
        function(t){
            t.runtimeStyle.zoom = 1;
            var maxW = parseInt(t.currentStyle[&#39;max-width&#39;], 10);
            var maxH = parseInt(t.currentStyle[&#39;max-height&#39;], 10);
            if (t.scrollWidth &gt; maxW &amp;&amp; t.scrollWidth &gt;= t.scrollHeight) {
                t.style.width = maxW;
            } else if (t.scrollHeight &gt; maxH) {
                t.style.height = maxH;
            }
        }(this)
    );
    }
</code></pre>
<h2 class="Heading" id="Positioning"><a class="Anchor" aria-hidden="true" href="#Positioning"></a><span class="ss01 hang-m">П</span>озиционирование</h2>
<p>Ре­а­ли­за­ция пра­виль­но­го аб­со­лют­но­го по­зи­ци­о­ни­ро­ва­ния (left+right/​​top+bot­tom), го­то­во для «px» и «%», надо те­сти­ро­вать и по­ста­вить про­вер­ку на вы­со­ту/​​ши­ри­ну (если мож­но). Мо­жет, до­ба­вить ис­прав­ле­ние для right/​​bot­tom при от­стут­ствии left/​​top?</p>
<pre><code class="undefinedCSS">* HTML .tblr {
    tblr:expression(
        function (t) {
            function to_px(input, dim) {
                return input.match(&#39;%&#39;) ? Math.floor(dim / 100 * parseInt(input, 10)) : parseInt(input, 10);
            }
            var h = t.parentNode.offsetHeight || t.parentNode.parentNode.offsetHeight;
            var w = t.parentNode.offsetWidth || t.parentNode.parentNode.offsetWidth;
            var top = to_px(t.currentStyle.top, h);
            var bottom = to_px(t.currentStyle.bottom, h);
            var left = to_px(t.currentStyle.left, w);
            var right = to_px(t.currentStyle.right, w);

            if (t.h != h || t.top != top || t.bottom != bottom || t.w != w || t.left != left || t.right != right) {
                if (h &gt;= 0 &amp;&amp; top &gt;= 0 &amp;&amp; bottom &gt;= 0) {
                    t.h = h;
                    t.top = top;
                    t.bottom = bottom;
                    t.style.height = h - (top + bottom) &gt; 0 ? h - (top + bottom) : 0;
                }
                if (w &gt;= 0 &amp;&amp; left &gt;= 0 &amp;&amp; right &gt;= 0) {
                    t.w = w;
                    t.left = left;
                    t.right = right;
                    t.style.width = w - (left + right) &gt; 0 ? w - (left + right) : 0;
                }
            }
        }(this)
    );
    }
</code></pre>
<p>Фикс для уби­ра­ния тряс­ки в ие при фик­си­ро­ван­ном по­зи­ци­о­ни­ро­вании</p>
<pre><code class="undefinedCSS">* HTML {
    background-image:url(about:blank);
    background-attachment:fixed;
    }
</code></pre>
<p>Экс­прешн для ней­тра­ли­за­ции тряс­ки в ие при фик­си­ро­ван­ном по­зи­ци­о­ни­ро­вании</p>
<pre><code class="undefinedCSS">* HTML {
    _behavior:expression(
        function(t){
            t.runtimeStyle.behavior = &#39;none&#39;;
            var style;
            if (t.currentStyle.backgroundImage) {
                style = t.runtimeStyle;
            } else {
                var body = document.documentElement || document.body;
                if (body.parentNode.currentStyle.backgroundImage) {
                    style = body.parentNode.runtimeStyle;
                }
            }
            if (style) {
                style.backgroundImage = &#39;url(about:blank)&#39;;
                style.backgroundAttachment = &#39;fixed&#39;;
            }
        }(this)
    );
    }
</code></pre>
<h2 class="Heading" id="Select"><a class="Anchor" aria-hidden="true" href="#Select"></a><span class="ss01 hang-m">П</span>ерекрытие селектов айфреймом <sup><a class="Link" href="select.html">при­мер</a></sup></h2>
<p>Ис­прав­ле­ние эле­мен­тов над се­лек­та­ми, надо бы сде­лать ва­ри­ант с от­сле­жи­ва­ни­ем со­сто­я­ния ис­ход­но­го эле­мен­та (ке­ши­ру­е­мый экс­прешн на дис­плей?)</p>
<pre><code class="undefinedCSS">.iframed {
    zoom:expression(
        function(t){
            t.runtimeStyle.zoom = 1;
            t.insertAdjacentHTML(&#39;beforeBegin&#39;,&#39;&lt;iframe src=&quot;about:blank&quot; style=&quot;position:absolute;filter:progid:DXImageTransform.Microsoft.Alpha(Opacity=0);opacity:0;padding:0;margin:0;border:0;expression:expression(function(t){var L=t.nextSibling.offsetLeft;var T=t.nextSibling.offsetTop;var W=t.nextSibling.offsetWidth;var H=t.nextSibling.offsetHeight;if(t.L!=L||t.T!=T||t.W!=W||t.H!=H){            t.runtimeStyle.left=t.L=L;t.runtimeStyle.top=t.T=T;t.runtimeStyle.width=t.W=W;t.runtimeStyle.height=t.H=H;}}(this));&quot;&gt;&lt;/iframe&gt;&#39;)
        }(this)
    );
    }
</code></pre>
<h2 class="Heading" id="Height"><a class="Anchor" aria-hidden="true" href="#Height"></a><span class="ss01 hang-m">Р</span>астягивание высоты</h2>
<p>Вы­со­та: 100%</p>
<pre><code class="undefinedCSS">.height100 {
    position:absolute;
    stretch:expression(
        function(t){
            var h = t.parentNode.offsetHeight;
            if (t.h != h) {
                t.style.height = t.h = h;
            }
        }(this)
    );
    }
</code></pre>
<h2 class="Heading" id="Opacity"><a class="Anchor" aria-hidden="true" href="#Opacity"></a><span class="ss01 hang-xs">O</span>pacity!</h2>
<p>Увы, вось­мой ие дол­жен ра­бо­тать в ре­жи­ме седь­мого.</p>
<pre><code class="undefinedCSS">.opacity {
    filter:expression(
        function(t){
            t.runtimeStyle.filter = &#39;progid:DXImageTransform.Microsoft.Alpha(opacity=&#39; + t.currentStyle.opacity * 100 + &#39;)&#39;;
        }(this)
    );
    }
</code></pre>
<p>А если надо без экс­преш­нов и в вось­мом, надо тупо вот так:</p>
<pre><code class="undefinedCSS">.opacity {
    -ms-filter:&quot;progid:DXImageTransform.Microsoft.Alpha(Opacity=0)&quot;;
    filter:progid:DXImageTransform.Microsoft.Alpha(Opacity=0);
    opacity:0;
    }
</code></pre>
<h2 class="Heading" id="Dpi"><a class="Anchor" aria-hidden="true" href="#Dpi"></a><span class="ss01 hang-m">Р</span>азмер шрифта в зависимости от dpi</h2>
<p>При­ме­ня­ем для <abbr>BODY</abbr>, пе­ре­опре­де­ляя стан­дарт­ную ве­ли­чи­ну (на са­мом деле, надо бы брать и пар­сить эту ве­ли­чи­ну, а не хард­ко­дить, <span class="nobr">по-хо</span>­ро­ше­<span class="nobr">му-то</span>)</p>
<pre><code class="undefinedCSS">BODY {
    font-size:expression(
        function(t){
            if (screen.deviceXDPI == screen.logicalXDPI) {
                t.runtimeStyle.fontSize = 6000/screen.logicalYDPI + &#39;%&#39;;
            } else {
                t.runtimeStyle.fontSize = &#39;62.5%&#39;;
            }
        }(this)
    );
    }
</code></pre>
<h2 class="Heading" id="Counter"><a class="Anchor" aria-hidden="true" href="#Counter"></a><span class="ss01 hang-m">Р</span>еализация простого счётчика <sup><a class="Link" href="counter.html">при­мер</a></sup></h2>
<p>Всем бра­у­зе­рам от­да­ём:</p>
<pre><code class="undefinedCSS">.list {
    counter-reset:list_item;
    }
    .list-item {
        display:block;
        }
        .list-item:before,
        .list-item-before {
            content:counter(list_item);
            counter-increment:list_item;
            }
</code></pre>
<p>А толь­ко для ие:</p>
<pre><code class="undefinedCSS">.list-item {
    list-style-type:expression(
        function(t){
            t.runtimeStyle.listStyleType = &#39;none&#39;;
            t.insertAdjacentHTML(&#39;afterBegin&#39;,&#39;&lt;span class=&quot;list-item-before&quot;&gt;&#39; + (++t.parentNode.IEcounter || (t.parentNode.IEcounter = 1)) + &#39;&lt;/span&gt;&#39;);
        }(this)
    );
    }
</code></pre>
<h2 class="Heading" id="Pseudoclass"><a class="Anchor" aria-hidden="true" href="#Pseudoclass"></a><span class="ss02 hang-xs">Э</span>муляции псевдоклассов <sup><a class="Link" href="pseudoclass.html">при­мер</a></sup></h2>
<p>Эму­ля­ция :hover</p>
<pre><code class="undefinedCSS">* HTML .some-block {
    _behavior: expression(
        function(t, hoverClass){
            t.runtimeStyle.behavior = &#39;none&#39;;
            hoverClass = hoverClass || t.className ? t.className.replace(/([^\s]+)/g,&#39;$1_hover&#39;) : &#39;hover&#39;;
            t.attachEvent(&#39;onmouseover&#39;,function() {
                t.className += (&#39; &#39; + hoverClass);
            });
            t.attachEvent(&#39;onmouseout&#39;,function() {
                t.className = t.className.replace(new RegExp(&#39; &#39; + hoverClass,&#39;g&#39;), &#39;&#39;);
            });
        }(this)
    );
    }
</code></pre>
<p>Эму­ля­ция :focus</p>
<pre><code class="undefinedCSS">* HTML .type-text {
    _behavior: expression(
        function(t, focusClass){
            t.runtimeStyle.behavior = &#39;none&#39;;
            focusClass = focusClass || t.className ? t.className.replace(/([^\s]+)/g,&#39;$1_focus&#39;) : &#39;focus&#39;;
            t.attachEvent(&#39;onfocus&#39;,function() {
                t.className += (&#39; &#39; + focusClass);
            });
            t.attachEvent(&#39;onblur&#39;,function() {
                t.className = t.className.replace(new RegExp(&#39; &#39; + focusClass,&#39;g&#39;), &#39;&#39;);
            });
        }(this)
    );
    }
</code></pre>
<p>Эму­ля­ция :target</p>
<pre><code class="undefinedCSS">#SomeBlock {
    behavior: expression(
        function(t, targetClass){
            if (t.id) {
                var hash = window.location.hash;
                if (!t.targetClass) {
                    t.targetClass = targetClass || t.className ? t.className.replace(/([^\s]+)/g,&#39;$1_target&#39;) : &#39;target&#39;;
                }
                if (t.lastHash != hash) {
                    t.lastHash = hash;
                    if (&quot;#&quot;+t.id == hash) {
                        t.className += (&#39; &#39; + t.targetClass);
                    } else {
                        t.className = t.className.replace(new RegExp(&#39; &#39; + t.targetClass,&#39;g&#39;), &#39;&#39;);
                    }
                }
            } else {
                t.runtimeStyle.behavior = &#39;none&#39;;
            }
        }(this)
    );
    }
</code></pre>
<h2 class="Heading" id="Credits"><a class="Anchor" aria-hidden="true" href="#Credits"></a><span class="ss01 hang-m">Б</span>лагодарности</h2>
<ul>
<li><a class="Link" href="http://lusever.livejournal.com/">Пав­лу Кор­ни­ло­ву</a> за <a class="Link" href="http://lusever.ru/proceedings/thin_css/">од­но­ра­зо­вые экс­преш­ны</a></li>
<li><a class="Link" href="http://vitaly.ya.ru/">Ви­та­лию Ха­ри­со­ву</a> за <a class="Link" href="http://subbotnik.yandex.st/css-framework/practice.html">ке­ши­ру­е­мые экс­преш­ны</a>
<sup>(при­мер­но 40-й слайд)</sup></li>
<li><a class="Link" href="http://www.cssplay.co.uk/">Stu Nicholls</a> за <a class="Link" href="http://www.cssplay.co.uk/menus/iframe-shim.html">идею с се­лек­та­ми</a></li>
<li><a class="Link" href="http://izenich.moikrug.ru/">Иго­рю Зе­ни­чу</a> за <a class="Link" href="http://habrahabr.ru/blogs/css/42794/">рас­кры­тие темы dpi</a></li>
</ul>

    </div>
    <footer class="Page-Footer">
      <div class="LiquidLayout">
        <div class="LiquidLayout-Content">
          <nav class="PrevNext">
          </nav>
          <p role="contentinfo" class="Page-Copy"><a href="/" class="Link Link_wrapper">© 2017 <span class="Link-Inner">Роман Комаров</span>. </a><a href="https://twitter.com/ki_zu" class="Link Link_wrapper"><span class="Link-Inner">Читайте меня в твиттере</span>!</a>
          </p>
        </div>
      </div>
    </footer>
    <script>var supportsWoff2=function(A){if(!("FontFace"in A)||"function"!=typeof A.FontFace)return!1;var t=new FontFace("t",'url( "data:application/font-woff2;base64,d09GMgABAAAAAADcAAoAAAAAAggAAACWAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAABk4ALAoUNAE2AiQDCAsGAAQgBSAHIBtvAcieB3aD8wURQ+TZazbRE9HvF5vde4KCYGhiCgq/NKPF0i6UIsZynbP+Xi9Ng+XLbNlmNz/xIBBqq61FIQRJhC/+QA/08PJQJ3sK5TZFMlWzC/iK5GUN40psgqvxwBjBOg6JUSJ7ewyKE2AAaXZrfUB4v+hze37ugJ9d+DeYqiDwVgCawviwVFGnuttkLqIMGivmDg" ) format( "woff2" )',{});return t.load()["catch"](function(){}),"loading"==t.status||"loaded"==t.status}(this),h=document.getElementsByTagName("head")[0],link=document.createElement("link");link.href="/s/extras"+(supportsWoff2?"2":"")+".css",link.type="text/css",link.rel="stylesheet",h.appendChild(link);
    </script>
    <script src="/j/prism.js"></script>
    <script src="//mc.yandex.ru/metrika/watch.js"></script>
    <script type="text/javascript">
      //<![CDATA[
      (function (d, w, c) { (w[c] = w[c] || []).push(function() { try { w.yaCounter632758 = new Ya.Metrika({id:632758, clickmap:true, trackLinks:true, trackHash:true, webvisor:true}); } catch(e) {} }); var n = d.getElementsByTagName("script")[0], s = d.createElement("script"), f = function () { n.parentNode.insertBefore(s, n); }; s.type = "text/javascript"; s.async = true; s.src = (d.location.protocol == "https:" ? "https:" : "http:") + "//mc.yandex.ru/metrika/watch.js"; if (w.opera == "[object Opera]") { d.addEventListener("DOMContentLoaded", f); } else { f(); } })(document, window, "yandex_metrika_callbacks");
      //]]>
    </script>
    <noscript><img src="//mc.yandex.ru/watch/632758" style="position:absolute; left:-9990px;" alt=""></noscript>
  </body>
</html>