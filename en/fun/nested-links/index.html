<!DOCTYPE html>
<html lang="en" class="Page Page_post Page_en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Nested Links</title>
    <link rel="alternate" type="application/atom+xml" title="Atom feed" href="http://feeds.feedburner.com/kizuruen">
    <link rel="alternate" hreflang="en" href="http://kizu.ru/en/fun/nested-links/">
    <link rel="alternate" hreflang="ru" href="http://kizu.ru/fun/nested-links/">
    <link rel="stylesheet" href="/s/style.css">
    <link rel="preload" href="/s/extras2.css" as="style" onload="this.rel='stylesheet'">
  </head>
  <body class="Page-Body">
    <header class="Page-Header">
      <div class="LiquidLayout">
        <div class="LiquidLayout-Content">
          <h1 class="Page-Title"><a href="/en/" class="Page-Title-Link">Roman Komarov</a>
          </h1>
          <ul class="Page-Languages">
            <li data-short="en" class="Page-Language is-current">in English
            </li>
            <li class="Page-Language"><a data-short="ru" href="/fun/nested-links/" class="Page-Language-Link">по-русски</a>
            </li>
          </ul>
        </div>
      </div>
    </header>
    <article role="main" class="Page-Content">
      <div class="LiquidLayout">
        <div class="Main LiquidLayout-Content">
          <header><h1 class="Heading" id="nested-links"><a class="Anchor" aria-hidden="true" href="#nested-links"></a><span class="ss01 hang-m">N</span>ested Link<span class="ss01">s</span></h1>
          </header>
<p><img src="nested-links.jpg" width="640" height="480" alt="Cats playing nested links"></p>
<h2 class="Heading" id="the-problem"><a class="Anchor" aria-hidden="true" href="#the-problem"></a><span class="ss01 hang-m">T</span>he problem</h2>
<p><abbr>HTML</abbr> spec­i­fi­ca­tion has a lot of dif­fer­ent re­stric­tions. And I have my doubts about the fea­si­bil­ity of many of those. One ex­am­ple which I stum­ble upon rather of­<span class="nobr">ten —</span><span class="thinsp"> </span>nested links.</p>
<p><a class="Link" href="http://www.w3.org/TR/html5/text-level-semantics.html#the-a-element">Spec</a> straightly for­bids such nesting:</p>
<blockquote>
<p>The <strong>a</strong> el­ement</p>
<p>[…]</p>
<p>Con­tent model: trans­par­ent, but there must be no <a class="Link" href="http://www.w3.org/TR/html5/dom.html#interactive-content-0">in­ter­ac­tive</a> con­tent de­scendant.</p>
</blockquote>
<p>And if you’d do this, browser’s parser won’t un­der­stand you and, as soon as it’d see the open­ing tag for the nested link, it would close the first one right there:</p>
<pre><code class="language-html">&lt;a href=&quot;#Foo&quot;&gt;
    Foo
    &lt;a href=&quot;#Bar&quot;&gt;
        Bar
    &lt;/a&gt;
    Baz
&lt;/a&gt;
</code></pre>
<p>in the eyes of the browser would be some­thing like <span class="nobr">that&#8202;—</span></p>
<pre><code class="language-html">&lt;a href=&quot;#Foo&quot;&gt;
    Foo
    &lt;/a&gt;&lt;a href=&quot;#Bar&quot;&gt;
        Bar
    &lt;/a&gt;
    Baz
</code></pre>
<p>And a live ex­ample:</p>
<div class="Demo Figure" id="Demo_nested-links-broken"><iframe class="Demo-Frame" style="height: 1.5em" width="100%" src="examples/nested-links-broken.html"></iframe></div>
<p>How­ever, there are cases when you’d want to nest one link in­side an­other de­spite the re­stric­tions.</p>
<p>So, once again, while work­ing on one task I stum­bled upon such case. I hap­pen to see and use dif­fer­ent workarounds for it be­fore, like an em­u­la­tion of the nested links with JS (for ex­am­ple, with ba­nal <code>onclick</code>), or po­si­tion­ing one of the links around the <span class="Sidenote-Wrapper"><a class="Sidenote-Context" href="#shared-wrapper" id="shared-wrapper">shared wrap­per</a><span class="Sidenote" role="note"><span class="Sidenote-Misc"> (</span>Look at <a href="http://jsfiddle.net/csswizardry/rxsna/">such so­lu­tion</a> by Harry Roberts<span class="Sidenote-Misc">)</span></span><a class="Sidenote-Close" href="#x" aria-hidden="true" tabindex="-1"></a></span>, but all those workarounds would­n’t work in all cases, and would­n’t work per­fectly. We’d ei­ther lose the na­tiv­ity of a link, try­ing to em­u­late every­thing from scratch, ei­ther won’t be able to make a workaround work just like prop­erly nested el­e­ments would.</p>
<p>So, af­ter try­ing and weigh­ing all the known workarounds in my head, I found out that I couldn&#39;t solve the cur­rent task by any of the workarounds other than full JS em­u­la­tion. But I stopped and de­cided to ex­per­i­ment a bit more.</p>
<p><span class="nobr">And —</span><span class="thinsp"> </span>found a proper so­lu­tion. <abbr>HTML</abbr>-only one, by the way, the one that gives you a way to nest any num­ber of links one into an­other.</p>
<h2 class="Heading" id="the-solution"><a class="Anchor" aria-hidden="true" href="#the-solution"></a><span class="ss01 hang-m">T</span>he so­lution</h2>
<div class="Demo Demo_injected Figure" id="Demo_nested-links-simple">

<style>

.demo-simple:hover {
    color: red !important;
}

.demo-simple .demo-simple:hover {
    color: lime !important;
}

</style>

<a class="demo-simple" href="#Foo">
    Foo
    <object type="lol/wut">
        <a class="demo-simple" href="#Bar">
            Bar
        </a>
    </object>
    Baz
</a>
</div>
<pre><code class="language-html">&lt;a href=&quot;#a&quot;&gt;
    Foo
    &lt;object type=&quot;lol/wut&quot;&gt;
        &lt;a href=&quot;#b&quot;&gt;
            Bar
        &lt;/a&gt;
    &lt;/object&gt;
    Baz
&lt;/a&gt;
</code></pre>
<p>What we do there is just plac­ing an ob­ject be­tween those links. Yep, it works: all parsers of mod­ern browsers sud­denly see those links in­de­pen­dently, and won’t break your markup any­more. Hooray.</p>
<h2 class="Heading" id="why-does-it-work"><a class="Anchor" aria-hidden="true" href="#why-does-it-work"></a><span class="ss01 hang-m">W</span>hy does it work</h2>
<p>What are ob­jects, in the­ory? They are some ex­ter­nal en­ti­ties, with the type set by the <code>type</code> at­tribute and the con­tent or a link to it placed into the <code>data</code> at­tribute. And the con­tent be­tween the open­ing and clos­ing <code>ob­ject</code> tags is, <span class="Sidenote-Wrapper"><a class="Sidenote-Context" href="#update" id="update">in fact</a><span class="Sidenote" role="note"><span class="Sidenote-Misc"> (</span>Ac­tu­ally, see the <a href="#update-from-2015-03-05">Up­date</a><span class="Sidenote-Misc">)</span></span><a class="Sidenote-Close" href="#x" aria-hidden="true" tabindex="-1"></a></span>, a fall­back, and it would be shown only when browser would­n’t be ca­pa­ble of dis­play­ing the ob­ject de­fined in the at­trib­utes. Like, for ex­am­ple, if you won’t have an in­stalled plugin.</p>
<p>And if you’d write some gib­ber­ish <abbr>MIME</abbr>-type into the <code>type</code> at­tribute, a browser would­n’t un­der­stand it and would go straight to dis­play­ing the fall­back. And, in fact, it would do the same even if you’d omit those “re­quired” at­trib­utes at all.</p>
<p>This way, af­ter wrap­ping any <abbr>HTML</abbr> with such at­tribut­e­less <code>&lt;ob­ject&gt;</code> we would get just a wrap­per el­e­ment for this con­tent. But a wrap­per with an un­usual trait: any con­tent in­side of it would be treated by browser’s parser with­out look­ing at the ob­jec­t’s con­text. So, us­ing this trait we can, fi­nally, nest one link into an­other, sep­a­rat­ing them for a parser.</p>
<p>I sup­pose that this be­hav­ior was in­tro­duced to browsers be­cause those ob­ject fall­backs were mostly used for show­ing links like “You don’t have our mar­velous plu­gin in­stalled, down­load it now!” (like, for flash ob­jects). And a lot of de­vel­op­ers could use such ob­jects as any other con­tent or im­<span class="nobr">ages —</span><span class="thinsp"> </span>nest­ing into all the other tags they had in <abbr>HTML</abbr>: links, head­ers, para­graphs, wher­ever. So, browsers needed this fall­back to dis­play prop­erly in those con­di­tions, and they in­tro­duced this be­hav­ior, so the “web­mas­ters” would be safe from break­ing their sites when in­sert­ing some copy-and-pasted code for such ex­ter­nal ob­jects into their pages.</p>
<h2 class="Heading" id="browser-support"><a class="Anchor" aria-hidden="true" href="#browser-support"></a><span class="ss01 hang-m">B</span>rowser support</h2>
<p>Not all of the browsers had this be­hav­ior from the start.</p>
<ul>
<li><p>In­ter­net Ex­plorer be­gan to be­have like this only from the 9th version.</p>
</li>
<li><p>Fire­<span class="nobr">fox —</span><span class="thinsp"> </span>from the 4th.</p>
</li>
<li><p><span class="nobr">Opera —</span><span class="thinsp"> </span>at least from 9th (maybe even ear­<span class="nobr">lier —</span><span class="thinsp"> </span>I did­n’t dig deeper than that).</p>
</li>
<li><p>We­<span class="nobr">bkits —</span><span class="thinsp"> </span>all that I checked: Sa­fari at least from 5.1, <span class="nobr">Chrome —</span><span class="thinsp"> </span>from 14, etc.</p>
</li>
</ul>
<p>Ob­vi­ously, the only browsers we’d need to sup­port with such con­di­tions are old IE, all other browsers al­ready be­have cor­rectly in all of the widely sup­ported ver­sions.</p>
<h3 class="Heading" id="ie-fallback"><a class="Anchor" aria-hidden="true" href="#ie-fallback"></a><span class="ss01 hang-m">I</span>E fallback</h3>
<p>I don’t know of any easy so­lu­tion for this prob­lem in old IE. At the very least you could try to fix it some­how by “re­mov­ing” the nested links us­ing con­di­tional com­ments:</p>
<pre><code class="language-html">&lt;a href=&quot;…&quot;&gt;
    content of the main link…
    &lt;object&gt;
        &lt;!--[if gte IE 9]&gt;&lt;!--&gt;&lt;a href=&quot;…&quot;&gt;&lt;!--&lt;![endif]--&gt;
            content of the nested link…
        &lt;!--[if gte IE 9]&gt;&lt;!--&gt;&lt;/a&gt;&lt;!--&lt;![endif]--&gt;
    &lt;/object&gt;
&lt;/a&gt;
</code></pre>
<p>You’d lose some func­tion­al­ity there, but it could be ok for the most cases. <span class="Sidenote-Wrapper"><a class="Sidenote-Context" href="#try-expressions" id="try-expressions">If not</a><span class="Sidenote" role="note"><span class="Sidenote-Misc"> (</span>Cu­ri­ous ones could think about if it is pos­si­ble to make a fall­back us­ing ex­pres­sions<span class="Sidenote-Misc">)</span></span><a class="Sidenote-Close" href="#x" aria-hidden="true" tabindex="-1"></a></span>, you could then in­sert those links later, sep­a­rately, us­ing the same con­di­tional com­ments, or use other workarounds for this problem.</p>
<h2 class="Heading" id="is-it-valid-"><a class="Anchor" aria-hidden="true" href="#is-it-valid-"></a><span class="ss01 hang-m">I</span>s it valid?</h2>
<p>Nope, not even close. It is not valid be­cause we don’t have any of the re­quired at­trib­utes on an ob­ject. We could set some dummy, but <a class="Link" href="http://www.w3.org/TR/html5/infrastructure.html#valid-mime-type">valid mime-type</a>, like <code>type=&quot;lol/​wut&quot;</code>, and the ob­ject it­self would then pass the val­i­da­tion, but as soon as we nest the link in­side of it, the val­ida­tor would throw us an error.</p>
<p>Ob­vi­ously, a val­ida­tor is a tool not show­ing any­thing but the for­mal spec­i­fi­ca­tions com­pli­ance. In our case, the us­age of links in­side ob­jects is en­tirely rea­son­able and won’t break any­thing for any­one if we’d make things in a proper way.</p>
<p>More than that, I do not see any rea­sons at all why specs should­n’t drop those re­stric­tions and al­low us to nest the links. No rea­sons. None. There are a lot of cases where this is a cru­cial re­quire­ment, and right now all we have are workarounds and “hacks” like this one.</p>
<h2 class="Heading" id="usage-examples"><a class="Anchor" aria-hidden="true" href="#usage-examples"></a><span class="ss01 hang-m">U</span>sage ex­amples</h2>
<p>At first, I wanted to de­scribe all the pos­si­ble use cases for the nested links, with live ex­am­ples and what­not, but then I re­mem­bered that such ex­am­ples won’t con­vince any­one who is­n’t al­ready con­vinced. Any­one who ever stum­bled upon this prob­lem would have every­thing they need from the so­lu­tion above, and oth­ers would al­ways be neg­a­tive about things like that, <em>be­cause specs</em>. Also: it is very tir­ing to mark up all those ex­am­ples, so I’ll just put them into a list:</p>
<ul>
<li><p>Ex­cerpts from the ar­ti­cles, when the snip­pet of first few sen­tences could con­tain links which you would­n’t want to strip from the markup.</p>
</li>
<li><p>Side­notes, foot­notes, and nested terms are all too can be in­side links, why not.</p>
</li>
<li><p>Any com­plex UI with a lot of nested en­ti­ties, which could hap­pen to be de­scribed as links. Those could be tweets in any of the Twit­ter’s in­ter­face, lead­ing to the tweet’s page, but at the same time con­tain­ing other <span class="nobr">links —</span><span class="thinsp"> </span>to users, hash­tags, and ex­ter­nal pages. Those could be mail in­ter­faces, where the snip­pet of a mes­sage in an in­box that should be a link to a mes­sage it­self could con­tain other <span class="nobr">links —</span><span class="thinsp"> </span>at­tach­ments, link to threads, la­bels, etc.</p>
</li>
</ul>
<h2 class="Heading" id="-"><a class="Anchor" aria-hidden="true" href="#-"></a><em> </em> *</h2>
<p>The one thing I’d like to say in the end is that that trick with an ob­ject could be ap­plied to any con­tent that you’d like to use some­where where the specs for­bid you to.</p>
<p>As an ex­am­ple, there are a bunch of new tags in the lat­est specs that you al­ready should know, like <code>de­tails</code> and <code>fig­ure</code>. Guess what: by specs you can use them only in flow-level con­texts: you can’t have pic­tures with cap­tions il­lus­trat­ing some word in­side a para­graph, you can’t have a de­scrip­tion or foot­notes for some words in­side a para­graph or a head­ing (and what other than <code>de­tails</code> tag would fit for this?), you can’t have a lot of cases that some­one do­ing specs could­n’t think of.</p>
<p>The <code>&lt;ob­ject&gt;</code> trick solves all those prob­lems. The ques­tion is only if such us­age would be fea­si­ble for you. And I’d say that a lot of re­stric­tions on specs are use­less and abil­ity to work around them, with valid ar­gu­ments, is priceless.</p>
<h2 class="Heading" id="update-from-2015-03-05"><a class="Anchor" aria-hidden="true" href="#update-from-2015-03-05"></a><span class="ss01 hang-m">U</span>pdate from <span class="nobr">2015-03</span>-05</h2>
<p><a class="Link" href="https://github.com/VovanR">Vladimir Rod­kin</a> found out that Fire­fox’ Flash­block plu­gin re­moves “bro­ken ob­jects”, and it treats at­tribut­e­less <code>&lt;ob­ject&gt;</code> as such. Adding un­known mime-type like <code>type=&quot;lol/​wut&quot;</code> fixes this prob­lem and Fx starts to show the ob­ject cor­rectly.</p>

          <p class="Metadata Published">Published on 
            <time datetime="2015-02-10">February 10, 2015</time>, in <a href="../" class="Link">Experiments</a>.
          </p>
          <p class="Metadata ThanksTo">Thanks to <a class="Link" href="http://taerin.deviantart.com/">Fev</a> for the illustration.
          </p>
          <aside class="Feedback">
            <p>If you've spotted a typo or a mistake, or wish to add something on, you could either <a href="https://github.com/kizu/kizu.github.com/issues/new?title=Feedback%20for%20%E2%80%9CNested%20Links%E2%80%9D" class="Link">write me about this</a> or <a href="https://github.com/kizu/kizu.github.com/blob/source/src/documents/posts/2015-02-10-(fun)-nested-links/index.en.md" class="Link">edit this article on Github</a>.
            </p>
          </aside>
        </div>
      </div>
    </article>
    <footer class="Page-Footer">
      <div class="LiquidLayout">
        <div class="LiquidLayout-Content">
          <nav class="PrevNext"><a href="/en/blog/flex-baseline/" class="Link Link_wrapper Link_prev"><span class="Link-Inner">Battle for Baseline</span></a><a href="/en/blog/the-new-version-of-this-site/" class="Link Link_wrapper Link_next"><span class="Link-Inner">The New Version of This Site</span></a>
          </nav>
          <p role="contentinfo" class="Page-Copy"><a href="/en/" class="Link Link_wrapper">© 2017 <span class="Link-Inner">Roman Komarov</span>. </a><a href="https://twitter.com/kizmarh" class="Link Link_wrapper"><span class="Link-Inner">Follow me on twitter</span>!</a>
          </p>
        </div>
      </div>
    </footer>
    <script>var supportsWoff2=function(A){if(!("FontFace"in A)||"function"!=typeof A.FontFace)return!1;var t=new FontFace("t",'url( "data:application/font-woff2;base64,d09GMgABAAAAAADcAAoAAAAAAggAAACWAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAABk4ALAoUNAE2AiQDCAsGAAQgBSAHIBtvAcieB3aD8wURQ+TZazbRE9HvF5vde4KCYGhiCgq/NKPF0i6UIsZynbP+Xi9Ng+XLbNlmNz/xIBBqq61FIQRJhC/+QA/08PJQJ3sK5TZFMlWzC/iK5GUN40psgqvxwBjBOg6JUSJ7ewyKE2AAaXZrfUB4v+hze37ugJ9d+DeYqiDwVgCawviwVFGnuttkLqIMGivmDg" ) format( "woff2" )',{});return t.load()["catch"](function(){}),"loading"==t.status||"loaded"==t.status}(this),h=document.getElementsByTagName("head")[0],link=document.createElement("link");link.href="/s/extras"+(supportsWoff2?"2":"")+".css",link.type="text/css",link.rel="stylesheet",h.appendChild(link);
    </script>
    <script src="/j/prism.js"></script>
    <script src="//mc.yandex.ru/metrika/watch.js"></script>
    <script type="text/javascript">
      //<![CDATA[
      (function (d, w, c) { (w[c] = w[c] || []).push(function() { try { w.yaCounter632758 = new Ya.Metrika({id:632758, clickmap:true, trackLinks:true, trackHash:true, webvisor:true}); } catch(e) {} }); var n = d.getElementsByTagName("script")[0], s = d.createElement("script"), f = function () { n.parentNode.insertBefore(s, n); }; s.type = "text/javascript"; s.async = true; s.src = (d.location.protocol == "https:" ? "https:" : "http:") + "//mc.yandex.ru/metrika/watch.js"; if (w.opera == "[object Opera]") { d.addEventListener("DOMContentLoaded", f); } else { f(); } })(document, window, "yandex_metrika_callbacks");
      //]]>
    </script>
    <noscript><img src="//mc.yandex.ru/watch/632758" style="position:absolute; left:-9990px;" alt=""></noscript>
  </body>
</html>